<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:mongodb="http://www.liquibase.org/xml/ns/mongodb"
        xsi:schemaLocation="
          http://www.liquibase.org/xml/ns/dbchangelog
          http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd
          http://www.liquibase.org/xml/ns/mongodb
          http://www.liquibase.org/xml/ns/mongodb/liquibase-mongodb-latest.xsd">

    <!-- 1) Collection -->
    <changeSet id="2025-12-26-001-create-payments-collection" author="you">
        <mongodb:createCollection collectionName="payments"/>
    </changeSet>

    <!-- 2) Indexes -->
    <changeSet id="2025-12-26-002-create-payments-indexes" author="you">

        <!-- unique(order_id) -->
        <mongodb:createIndex collectionName="payments">
            <mongodb:keys>{ order_id: 1 }</mongodb:keys>
            <mongodb:options>{ unique: true, name: "uk_payments_order_id" }</mongodb:options>
        </mongodb:createIndex>

        <!-- user_id -->
        <mongodb:createIndex collectionName="payments">
            <mongodb:keys>{ user_id: 1 }</mongodb:keys>
            <mongodb:options>{ name: "idx_payments_user_id" }</mongodb:options>
        </mongodb:createIndex>

        <!-- status -->
        <mongodb:createIndex collectionName="payments">
            <mongodb:keys>{ status: 1 }</mongodb:keys>
            <mongodb:options>{ name: "idx_payments_status" }</mongodb:options>
        </mongodb:createIndex>

        <!-- timestamp -->
        <mongodb:createIndex collectionName="payments">
            <mongodb:keys>{ timestamp: 1 }</mongodb:keys>
            <mongodb:options>{ name: "idx_payments_timestamp" }</mongodb:options>
        </mongodb:createIndex>

        <!-- compound user_id + status + timestamp -->
        <mongodb:createIndex collectionName="payments">
            <mongodb:keys>{ user_id: 1, status: 1, timestamp: 1 }</mongodb:keys>
            <mongodb:options>{ name: "idx_payments_user_status_timestamp" }</mongodb:options>
        </mongodb:createIndex>

    </changeSet>

</databaseChangeLog>
